version: '3'

services:
  api-gateway:
    build:
      context: .
      dockerfile: development.Dockerfile
    image: microservices-workshop/api-gateway:dev
    restart: on-failure
    environment:
      - VIRTUAL_HOST=api-gateway.app.com
      - COTE_DISCOVERY_REDIS_HOST=10.33.30.5      # ðŸ”¹ Redis running on your Windows host
      - COTE_DISCOVERY_REDIS_PORT=6379             # ðŸ”¹ Explicit Redis port (recommended)
    ports:
      - "3000:3000"
    volumes:
      - ./api-gateway:C:\app\src
      - ./libs:C:\app\libs
      - C:/EPARTS/eparts_dev_files/logfile:/app/logs
      - C:/EPARTS/eparts_dev_files/assets:/app/assets
    depends_on:
      - admin-service

  admin-service:
    build:
      context: .
      dockerfile: development.Dockerfile
    image: microservices-workshop/admin-service:dev
    restart: on-failure
    environment:
      DB_HOST: 10.33.30.5          # ðŸ”¹ PostgreSQL running on Windows host
      DB_PORT: 5432
      DB_USER: postgres
      DB_PASSWORD: ExZ3naPw@32!perts
      DB_NAME: eparts_core
      COTE_DISCOVERY_REDIS_HOST: 10.33.30.5
      COTE_DISCOVERY_REDIS_PORT: 6379
    volumes:
      - ./service/admin-service:C:\app\src
      - ./libs:C:\app\libs
      - C:/EPARTS/eparts_dev_files/logfile:/app/logs
      - C:/EPARTS/eparts_dev_files/assets:/app/assets

    buyer-service:
    build:
      context: .
      dockerfile: development.Dockerfile
    image: microservices-workshop/buyer-service:dev
    restart: on-failure
    environment:
      DB_HOST: 10.33.30.5          # ðŸ”¹ PostgreSQL running on Windows host
      DB_PORT: 5432
      DB_USER: postgres
      DB_PASSWORD: ExZ3naPw@32!perts
      DB_NAME: eparts_core
      COTE_DISCOVERY_REDIS_HOST: 10.33.30.5
      COTE_DISCOVERY_REDIS_PORT: 6379
    volumes:
      - ./service/buyer-service:C:\app\src
      - ./libs:C:\app\libs
      - C:/EPARTS/eparts_dev_files/logfile:/app/logs
      - C:/EPARTS/eparts_dev_files/assets:/app/assets

    seller-service:
    build:
      context: .
      dockerfile: development.Dockerfile
    image: microservices-workshop/seller-service:dev
    restart: on-failure
    environment:
      DB_HOST: 10.33.30.5          # ðŸ”¹ PostgreSQL running on Windows host
      DB_PORT: 5432
      DB_USER: postgres
      DB_PASSWORD: ExZ3naPw@32!perts
      DB_NAME: eparts_core
      COTE_DISCOVERY_REDIS_HOST: 10.33.30.5
      COTE_DISCOVERY_REDIS_PORT: 6379
    volumes:
      - ./service/seller-service:C:\app\src
      - ./libs:C:\app\libs
      - C:/EPARTS/eparts_dev_files/logfile:/app/logs
      - C:/EPARTS/eparts_dev_files/assets:/app/assets

 
