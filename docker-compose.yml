# version: '3'

# services:

#   api-gateway:
#     build:
#       context: .
#       dockerfile: development.Dockerfile
#     image: microservices-workshop/api-gateway:dev
#     restart: on-failure
#     environment:
#       - VIRTUAL_HOST=api-gateway.app.com
#     ports:
#       - 3000:3000
#     volumes:
#       - ./api-gateway:/app/src
#       - ./libs:/src/libs   


#   users-service:
#     build:
#       context: .
#       dockerfile: development.Dockerfile
#     image: microservices-workshop/users-service:dev
#     restart: on-failure
#     environment:
#       DB_HOST: postgres-db
#       DB_PORT: 5432
#       DB_USER: postgres
#       DB_PASSWORD: ExZ3naPw@32!perts
#       DB_NAME: postgres
#     volumes:
#       - ./service/users-service:/app/src
#       - ./libs:/app/libs       # <-- added libs mapping
#     depends_on:
#       - postgres-db

#   postgres-db:
#     image: stefanscherer/postgres-windows:9.6
#     environment:
#       POSTGRES_USER: postgres
#       POSTGRES_PASSWORD: ExZ3naPw@32!perts
#       POSTGRES_DB: postgres
#     ports:
#       - "5432:5432"             # <-- changed to standard port
#     volumes:
#       - postgres-data:/var/lib/postgresql/data

# volumes:
#   postgres-data:


# version: '3'

# services:
#   api-gateway:
#     build:
#       context: .
#       dockerfile: development.Dockerfile
#     image: microservices-workshop/api-gateway:dev
#     restart: on-failure
#     environment:
#       - VIRTUAL_HOST=api-gateway.app.com
#     ports:
#       - 3000:3000
#     volumes:
#       - ./api-gateway:C:\app\src
#       - ./libs:C:\app\libs 

#   users-service:
#     build:
#       context: .
#       dockerfile: development.Dockerfile
#     image: microservices-workshop/users-service:dev
#     restart: on-failure
#     environment:
#       DB_HOST: host.docker.internal   # connects to your local PostgreSQL
#       DB_PORT: 5432
#       DB_USER: postgres
#       DB_PASSWORD: ExZ3naPw@32!perts
#       DB_NAME: postgres
      
#     volumes:
#       - ./service/users-service:C:\app\src
#       - ./libs:C:\app\libs



version: '3'

services:
  api-gateway:
    build:
      context: .
      dockerfile: development.Dockerfile
    image: microservices-workshop/api-gateway:dev
    restart: on-failure
    environment:
      - VIRTUAL_HOST=api-gateway.app.com
      - COTE_DISCOVERY_REDIS_HOST=10.33.30.5   # ðŸ”¹ Redis on Windows host
    ports:
      - 3000:3000
    volumes:
      - ./api-gateway:C:\app\src
      - ./libs:C:\app\libs

  users-service:
    build:
      context: .
      dockerfile: development.Dockerfile
    image: microservices-workshop/users-service:dev
    restart: on-failure
    environment:
      DB_HOST: 10.33.30.5  # ðŸ”¹ your PostgreSQL on host
      DB_PORT: 5432
      DB_USER: postgres
      DB_PASSWORD: ExZ3naPw@32!perts
      DB_NAME: postgres
      COTE_DISCOVERY_REDIS_HOST: 10.33.30.5   # ðŸ”¹ Redis discovery same
    volumes:
      - ./service/users-service:C:\app\src
      - ./libs:C:\app\libs
